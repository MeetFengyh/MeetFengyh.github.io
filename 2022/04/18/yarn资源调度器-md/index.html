<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>yarn资源调度器.md | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Yarn基础架构yarn主要由ResourceManager，NodeManager，ApplicationMaster，Container等组件构成。 ResourceManager 作为主守护程序运行，该仲裁程序在各种竞争应用程序之间仲裁可用的群集资源。ResourceManager 跟踪群集上可用的活动节点和资源的数量，并协调用户提交的应用程序应获取这些资源的时间和时间。ResourceMa">
<meta property="og:type" content="article">
<meta property="og:title" content="yarn资源调度器.md">
<meta property="og:url" content="http://example.com/2022/04/18/yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E5%99%A8-md/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Yarn基础架构yarn主要由ResourceManager，NodeManager，ApplicationMaster，Container等组件构成。 ResourceManager 作为主守护程序运行，该仲裁程序在各种竞争应用程序之间仲裁可用的群集资源。ResourceManager 跟踪群集上可用的活动节点和资源的数量，并协调用户提交的应用程序应获取这些资源的时间和时间。ResourceMa">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="d:/hc_data/document/hcyy-dw-resource/fyh/image/yarn基础架构.jpg">
<meta property="og:image" content="d:/hc_data/document/hcyy-dw-resource/fyh/image/yarn工作机制.jpg">
<meta property="article:published_time" content="2022-04-18T09:29:38.000Z">
<meta property="article:modified_time" content="2022-05-19T11:46:37.868Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="d:/hc_data/document/hcyy-dw-resource/fyh/image/yarn基础架构.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.1.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-yarn资源调度器-md" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/04/18/yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E5%99%A8-md/" class="article-date">
  <time class="dt-published" datetime="2022-04-18T09:29:38.000Z" itemprop="datePublished">2022-04-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      yarn资源调度器.md
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Yarn基础架构"><a href="#Yarn基础架构" class="headerlink" title="Yarn基础架构"></a>Yarn基础架构</h1><p>yarn主要由ResourceManager，NodeManager，ApplicationMaster，Container等组件构成。</p>
<p>ResourceManager 作为主守护程序运行，该仲裁程序在各种竞争应用程序之间仲裁可用的群集资源。ResourceManager 跟踪群集上可用的活动节点和资源的数量，并协调用户提交的应用程序应获取这些资源的时间和时间。ResourceManager 是具有此信息的单个进程，因此它可以以共享，安全和多租户的方式进行分配（或者更确切地说，调度）决策（例如，根据应用程序优先级，队列容量，ACL，数据位置等）。</p>
<p>当用户提交应用程序时，将启动名为 ApplicationMaster 的轻量级进程实例，以协调应用程序中所有任务的执行。这包括监视任务，重新启动失败的任务，推测性地运行慢速任务以及计算应用程序计数器的总值。这些职责先前已分配给所有工作的单个 JobTracker。ApplicationMaster 和属于其应用程序的任务在 NodeManagers 控制的资源容器中运行。</p>
<p>ApplicationMaster 可以在容器内运行任何类型的任务。例如，MapReduce ApplicationMaster 请求容器启动 map 或 reduce 任务，而 Giraph ApplicationMaster 请求容器运行 Giraph 任务。您还可以实现运行特定任务的自定义 ApplicationMaster，并以此方式创建一个闪亮的新分布式应用程序框架，该框架可以更改大数据世界。我鼓励您阅读 Apache Twill，它旨在简化编写位于 YARN 之上的分布式应用程序。</p>
<p>一个可以运行任何分布式应用程序的集群 ResourceManager，NodeManager 和容器不关心应用程序或任务的类型。所有特定于应用程序框架的代码都被简单地移动到其 ApplicationMaster，以便 YARN 可以支持任何分布式框架，只要有人为它实现适当的 ApplicationMaster。由于这种通用方法，运行许多不同工作负载的 Hadoop YARN 集群的梦想成真。想象一下：数据中心内的单个 Hadoop 集群可以运行 MapReduce，Giraph，Storm，Spark，Tez &#x2F; Impala，MPI 等。</p>
<h2 id="ResourceManager"><a href="#ResourceManager" class="headerlink" title="ResourceManager"></a>ResourceManager</h2><p>RM 是一个全局的资源管理器，集群只有一个，负责整个系统的资源管理和分配，包括处理客户端请求、启动&#x2F;监控 ApplicationMaster、监控 NodeManager、资源的分配与调度。它主要由两个组件构成：调度器（Scheduler）和应用程序管理器（Applications Manager，ASM）。</p>
<h2 id="调度器"><a href="#调度器" class="headerlink" title="调度器"></a>调度器</h2><p>调度器根据容量、队列等限制条件（如每个队列分配一定的资源，最多执行一定数量的作业等），将系统中的资源分配给各个正在运行的应用程序。需要注意的是，该调度器是一个“纯调度器”，它从事任何与具体应用程序相关的工作，比如不负责监控或者跟踪应用的执行状态等，也不负责重新启动因应用执行失败或者硬件故障而产生的失败任务，这些均交由应用程序相关的 ApplicationMaster 完成。</p>
<p>调度器仅根据各个应用程序的资源需求进行资源分配，而资源分配单位用一个抽象概念“资源容器”（ResourceContainer，简称 Container）表示，Container 是一个动态资源分配单位，它将内存、CPU、磁盘、网络等资源封装在一起，从而限定每个任务使用的资源量。</p>
<h2 id="应用程序管理器"><a href="#应用程序管理器" class="headerlink" title="应用程序管理器"></a>应用程序管理器</h2><p>应用程序管理器主要负责管理整个系统中所有应用程序，接收 job 的提交请求，为应用分配第一个 Container 来运行 ApplicationMaster，包括应用程序提交、与调度器协商资源以启动 ApplicationMaster、监控ApplicationMaster 运行状态并在失败时重新启动它等。</p>
<h2 id="ApplicationMaster"><a href="#ApplicationMaster" class="headerlink" title="ApplicationMaster"></a>ApplicationMaster</h2><p>管理 YARN 内运行的一个应用程序的每个实例。关于 job 或应用的管理都是由 ApplicationMaster 进程负责的，Yarn 允许我们以为自己的应用开发 ApplicationMaster。</p>
<p>功能：(1)数据切分；(2)为应用程序申请资源并进一步分配给内部任务（TASK）；(3)任务监控与容错。</p>
<p>负责协调来自 ResourceManager 的资源，并通过 NodeManager 监视容易的执行和资源使用情况。Yarn 的动态性，就是来源于多个 Application 的 ApplicationMaster 动态地和 ResourceManager 进行沟通，不断地申请、释放、再申请、再释放资源的过程。</p>
<h2 id="NodeManager"><a href="#NodeManager" class="headerlink" title="NodeManager"></a>NodeManager</h2><p>NodeManager 整个集群有多个，负责每个节点上的资源和使用。NodeManager 是一个 slave 服务：它负责接收 ResourceManager 的资源分配请求，分配具体的 Container 给应用。同时，它还负责监控并报告 Container 使用信息给 ResourceManager。通过和 ResourceManager 配合，NodeManager 负责整个 Hadoop 集群中的资源分配工作。</p>
<p>功能：本节点上的资源使用情况和各个 Container 的运行状态（cpu 和内存等资源）</p>
<p>(1)接收及处理来自 ResourceManager 的命令请求，分配 Container 给应用的某个任务；(2)定时地向 RM 汇报以确保整个集群平稳运行，RM 通过收集每个 NodeManager 的报告信息来追踪整个集群健康状态的，而 NodeManager 负责监控自身的健康状态；(3)处理来自 ApplicationMaster 的请求；(4)管理着所在节点每个 Container 的生命周期；(5)管理每个节点上的日志；(6)执行 Yarn 上面应用的一些额外的服务，比如 MapReduce 的 shuffle 过程。</p>
<p>当一个节点启动时，它会向 ResourceManager 进行注册并告知 ResourceManager 自己有多少资源可用。在运行期，通过 NodeManager 和 ResourceManager 协同工作，这些信息会不断被更新并保障整个集群发挥出最佳状态。NodeManager 只负责管理自身的 Container，它并不知道运行在它上面应用的信息。负责管理应用信息的组件是 ApplicationMaster。</p>
<h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><p>Container 是 YARN 中的资源抽象，它封装了某个节点上的多维度资源，如内存、CPU、磁盘、网络等，当 AM 向 RM 申请资源时，RM 为 AM 返回的资源便是用 Container 表示的。YARN 会为每个任务分配一个 Container，且任务只能使用该 Container 中描述的资源。</p>
<p>Container 和集群节点的关系是：一个节点会运行多个 Container，但一个 Container 不会跨节点。任何一个 job 或 application 必须运行在一个或多个 Container 中，在 Yarn 框架中，ResourceManager 只负责告诉 ApplicationMaster 哪些 Containers 可以用，ApplicationMaster 还需要去找 NodeManager 请求分配具体的 Container。</p>
<p>需要注意的是，Container 是一个动态资源划分单位，是根据应用程序的需求动态生成的。目前为止，YARN 仅支持 CPU 和内存两种资源，且使用了轻量级资源隔离机制 Cgroups 进行资源隔离。</p>
<p>Resource Request 及 Container<br>Yarn 的设计目标就是允许我们的各种应用以共享、安全、多租户的形式使用整个集群。并且，为了保证集群资源调度和数据访问的高效性，Yarn 还必须能够感知整个集群拓扑结构。</p>
<p>为了实现这些目标，ResourceManager 的调度器 Scheduler 为应用程序的资源请求定义了一些灵活的协议，通过它就可以对运行在集群中的各个应用做更好的调度，因此，这就诞生了 Resource Request 和 Container。一个应用先向 ApplicationMaster 发送一个满足自己需求的资源请求，然后 ApplicationMaster 把这个资源请求以resource-request 的形式发送给 ResourceManager 的 Scheduler，Scheduler 再在这个原始的 resource-request 中返回分配到的资源描述 Container。</p>
<p><img src="D:\hc_data\document\hcyy-dw-resource\fyh\image\yarn基础架构.jpg"></p>
<p>ResourceManager:</p>
<ol>
<li>处理客户端请求</li>
<li>监控NodeManager</li>
<li>启动或监控ApplicationMaster</li>
<li>资源分配与调度</li>
</ol>
<p>NodeManager:</p>
<ol>
<li>管理单个节点的资源</li>
<li>处理来自ResourceManager的命令</li>
<li>处理来自ApplicationMaster的命令</li>
</ol>
<p>ApplicationMaster:</p>
<ol>
<li>为应用程序申请资源并分配内部任务</li>
<li>Map、Reduce任务的监控与容错</li>
</ol>
<p>Container:</p>
<ul>
<li>是yarn资源的抽象，封装了多维度的资源，如内存、cpu、网络、磁盘等。</li>
</ul>
<h1 id="Yarn工作机制"><a href="#Yarn工作机制" class="headerlink" title="Yarn工作机制"></a>Yarn工作机制</h1><p><img src="D:\hc_data\document\hcyy-dw-resource\fyh\image\yarn工作机制.jpg" alt="yarn工作机制"></p>
<ol>
<li>MR程序提交到客户端所在节点，向ResourceManager申请执行一个应用。</li>
<li>ResourceManager经过判断，有资源可以分配，批准可以执行应用，返回Applicationid和资源文件上传临时路径。</li>
<li>在准备阶段，job会生成3个文件放在第二步，分别是job.split，job.xml，jar包。job.split保存的是任务的切片信息，ApplicationMaster会根据切片信息申请执行的maptask。job.xml存放的是yarn和hdfs的配置信息。</li>
<li>开始申请运行mrAppMaster,这个进程负责你整个Job,整个运行期间状态监控,容错,资源申请等等.一个进程在Yarn上运行必须要申请Container.Container里面有cpu内存资源和mrAppmaster提供你Job的运行。</li>
<li>向ResourceManager提交请求,请求会初始化一个Task, 然后进入ResourceManager的调度队列里面。</li>
<li>NodeManager负责从ResourceManager的队列里面来领取任务,领取之后给你封装出一个Container</li>
<li>创建完Container之后里面有MRAppMaster运行需要的CPU和内存资源等等。</li>
<li>然后MRAppMaster一运行就会把之前步骤2目录那里生成的文件下载到本地,紧接着会读取本件里面的内容,读到job.xml里面的数据就知道要启动几个MapTask和几个ReduceTask了。</li>
<li>开始向ResourceManager继续申请运行MapTask容器,运行几个得看job.xml里面的值.同样申请也是会进到步骤五那里的ResourceManager调度队列里面。</li>
<li>NodeManager从ResourceManager调度队列里面领取到任务,就开始创建容器运行MapTask。</li>
<li>MrAppMaster会把步骤2的wc.jar和job.xml配置文件和MrAppMaster自动生成的程序的启动脚本发给步骤10的MapTask,然后就运行脚本,就启动程序了,紧接着MapTask就生成自己的结果了。</li>
<li>然后向步骤五的ResourceManager申请任务,进入调度队列里面,申请成功之后创建Container容器后,会运行ReduceTask任务。</li>
<li>ReduceTask向Map获取相应的分区数据</li>
<li>程序运行完成之后,MRAppMaster会向ResourceManager申请注销掉自己.注销之后Container容器就会被销毁,资源就被释放。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2022/04/18/yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E5%99%A8-md/" data-id="cl3cyerhj0001uwu512daa1o2" data-title="yarn资源调度器.md" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/04/18/hive%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98-md/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          hive调优实战.md
        
      </div>
    </a>
  
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/05/17/kerberos%E9%83%A8%E7%BD%B2/">kerberos部署</a>
          </li>
        
          <li>
            <a href="/2022/04/18/hive%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98-md/">hive调优实战.md</a>
          </li>
        
          <li>
            <a href="/2022/04/18/yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E5%99%A8-md/">yarn资源调度器.md</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>